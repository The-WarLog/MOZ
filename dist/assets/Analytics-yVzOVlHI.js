import{D as N}from"./DisplayData-DvV1xkRa.js";import{C as k,r as V,S as B}from"./chart-C4gzvdzJ.js";import{d as H,e as S,c as u,a as n,b as C,w as I,t as i,F as A,r as O,n as U,o as p,f as D,_ as z}from"./index-BCkT4aEN.js";const J={class:"analytics"},K={key:0},L={class:"metrics-row"},M={class:"metric-card"},Q={class:"metric-value"},Z={class:"metric-card"},G={class:"metric-value"},W={class:"metric-card"},X={class:"metric-value"},Y={class:"charts-grid"},tt={class:"chart-card"},et={class:"region-stats"},nt={class:"region-name"},st={class:"region-bar-container"},rt={class:"region-value"},ot={class:"chart-card"},at={class:"product-list"},it={class:"product-rank"},lt={class:"product-details"},ct={class:"product-name"},dt={class:"product-bar-container"},ut={class:"product-value"},pt={class:"chart-card full-width"},_t={class:"timeline-chart"},gt={style:{display:"none"}},vt={key:1,class:"empty"},ht=H({name:"SalesAnalytics",__name:"Analytics",setup(mt){k.register(...V);const v=S(null);let l=null;const h=S({regions:[],products:[],startDate:null,endDate:null});let y="",m=null,b=[];const F=e=>Array.from(new Set(e.map(t=>t.region))),R=e=>Array.from(new Set(e.map(t=>t.product))),c=e=>{const t=h.value,r=JSON.stringify([e===m?e.length:e.length+":"+(e[0]?.sale_id??""),[...t.regions].sort(),[...t.products].sort(),t.startDate||"",t.endDate||""]);if(m===e&&y===r)return b;const o=e.filter(s=>{const a=t.regions.length===0||t.regions.includes(s.region),d=t.products.length===0||t.products.includes(s.product),q=!t.startDate||s.date>=t.startDate,E=!t.endDate||s.date<=t.endDate;return a&&d&&q&&E});return m=e,y=r,b=o,o},x=e=>!e||e.length===0?0:e.reduce((r,o)=>r+o.total_price,0)/e.length,T=e=>e?e.reduce((t,r)=>t+r.quantity,0):0;let _=null;const w=e=>{if(!e||e.length===0)return[];if(_&&_.sales===e)return _.result;const t={};e.forEach(s=>{const a=s.region??"Others";t[a]=(t[a]||0)+s.total_price});const r=Object.values(t).reduce((s,a)=>s+a,0),o=Object.entries(t).map(([s,a])=>({region:s,total:a,percentage:r>0?a/r*100:0})).sort((s,a)=>a.total-s.total);return _={sales:e,result:o},o};let g=null;const $=e=>{if(!e||e.length===0)return[];if(g&&g.sales===e)return g.result;const t={};e.forEach(a=>{t[a.product]=(t[a.product]||0)+a.total_price});const r=Object.entries(t).sort((a,d)=>d[1]-a[1]).slice(0,5),o=r[0]?.[1]||1,s=r.map(([a,d])=>({name:a,revenue:d,percentage:d/o*100}));return g={sales:e,result:s},s},j=e=>{if(!v.value||!e||e.length===0)return;const t={};e.forEach(s=>{t[s.date]=(t[s.date]||0)+s.total_price});const r=Object.keys(t).sort(),o=r.map(s=>t[s]??0);if(l){l.data.labels=r;const s=l.data.datasets[0];s?(s.data=o,l.update("none")):(l.data.datasets=[{label:"Daily Sales ($)",data:o,borderColor:"#3498db",backgroundColor:"rgba(52, 152, 219, 0.1)",tension:.4,fill:!0,pointRadius:4,pointHoverRadius:6}],l.update("none"));return}l=new k(v.value,{type:"line",data:{labels:r,datasets:[{label:"Daily Sales ($)",data:o,borderColor:"#3498db",backgroundColor:"rgba(52, 152, 219, 0.1)",tension:.4,fill:!0,pointRadius:4,pointHoverRadius:6}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"},tooltip:{callbacks:{label:s=>{const a=s.parsed;return"Sales: $"+(typeof a=="number"?a:a&&typeof a.y=="number"?a.y:0).toFixed(2)}}}},scales:{y:{beginAtZero:!0,ticks:{callback:s=>"$"+s}}}}})};let f=null;const P=e=>(f!==null&&cancelAnimationFrame(f),f=requestAnimationFrame(()=>{e&&e.length&&U(()=>j(e))}),null);return(e,t)=>(p(),u("div",J,[t[8]||(t[8]=n("h2",null,"Sales Analytics",-1)),C(N,null,{default:I(({salesData:r})=>[C(B,{filters:h.value,"onUpdate:filters":t[0]||(t[0]=o=>h.value=o),"available-regions":F(r),"available-products":R(r)},null,8,["filters","available-regions","available-products"]),c(r).length>0?(p(),u("div",K,[n("div",L,[n("div",M,[t[1]||(t[1]=n("h3",null,"Avg Order Value",-1)),n("p",Q,"$"+i(x(c(r)).toFixed(2)),1)]),n("div",Z,[t[2]||(t[2]=n("h3",null,"Total Units Sold",-1)),n("p",G,i(T(c(r))),1)]),n("div",W,[t[3]||(t[3]=n("h3",null,"Total Transactions",-1)),n("p",X,i(c(r).length),1)])]),n("div",Y,[n("div",tt,[t[4]||(t[4]=n("h3",null,"Sales by Region",-1)),n("div",et,[(p(!0),u(A,null,O(w(c(r)),o=>(p(),u("div",{key:o.region,class:"region-item"},[n("span",nt,i(o.region),1),n("div",st,[n("div",{class:"region-bar",style:D({width:o.percentage+"%"})},null,4)]),n("span",rt,"$"+i(o.total.toFixed(0)),1)]))),128))])]),n("div",ot,[t[5]||(t[5]=n("h3",null,"Top 5 Products by Revenue",-1)),n("div",at,[(p(!0),u(A,null,O($(c(r)),(o,s)=>(p(),u("div",{key:o.name,class:"product-item"},[n("span",it,i(s+1),1),n("div",lt,[n("span",ct,i(o.name),1),n("div",dt,[n("div",{class:"product-bar",style:D({width:o.percentage+"%"})},null,4)])]),n("span",ut,"$"+i(o.revenue.toFixed(0)),1)]))),128))])])]),n("div",pt,[t[6]||(t[6]=n("h3",null,"Sales Timeline (Daily)",-1)),n("div",_t,[n("canvas",{ref_key:"timelineCanvas",ref:v},null,512)])]),n("div",gt,i(P(c(r))),1)])):(p(),u("div",vt,[...t[7]||(t[7]=[n("p",null,"No data matches the current filters. Try adjusting your selection.",-1)])]))]),_:1})]))}}),kt=z(ht,[["__scopeId","data-v-023a28c8"]]);export{kt as default};
